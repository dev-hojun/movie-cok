{% extends "common/base.html" %}
{% block content %}
{% load static %}

<head>
	<link rel="stylesheet" href="{% static 'common/css/style.css' %}">
	<link rel="stylesheet" href="{% static 'movie/css/movieinfo.css' %}">
</head>
    <div class="container flexBox my-3">
        <div class="content">
            <div class="white_title">영화 정보</div>
            <hr></hr>
                <div>
                    <div class="row">
                        <div class="col-lg-7 mt-2">
                            <div class="movie_content bg-light rounded-3 p-3">
                                <div class="mr-5">  
                                    <li class="mb-3">
                                        <h3>{{movie.title}}</h3>
                                    </li>                             
                                    <li>네티즌
                                        <span><b class="star">★ </b>{{movie.score.score_npro}}</span> <!-- 하위 a태그와 다른 양식을 위해 span 처리-->
                                    </li>
                                    <li>기자·평론가
                                        <span><b class="star">★</b>{{movie.score.score_pro}}</span>
                                    </li>
                                    <li>개요
                                        <a href="">{{movie.genre}}</a>
                                    </li>
                                    <li>감독
                                        <a>{{movie.directors}}</a>
                                    </li>
                                    <li>출연
                                        <a>{{movie.actors}}</a>
                                    </li>
                                    <li>등급
                                    {% if movie.age == 0 %}
                                        <a>전체 관람가</a>
                                    {% elif movie.age == 19 %}
                                        <a>청소년 관람불가</a>
                                    {% else %}
                                        <a>{{movie.age}}세 관람가</a>
                                    {% endif %}
                                    </li>
                                    <li>상영시간
                                        <a>{{movie.playtime}}</a>
                                    </li>
                                    <li>개봉일
                                        <a>{{movie.date}}</a>
                                    </li>
                                </div>
                                
                                <div>
                                    <img src="{{movie.image}}">
                                </div>
                            </div>
                            <div class="summary my-3  bg-light rounded-3 p-3">
                                <li>줄거리</li>
                                <p>{{movie.summary}}</p>
                            </div>
                        <input type="hidden" id="production" value="{{movie.score.production}}">
                        <input type="hidden" id="acting" value="{{movie.score.acting}}">
                        <input type="hidden" id="story" value="{{movie.score.story}}">
                        <input type="hidden" id="visual" value="{{movie.score.visual}}">
                        <input type="hidden" id="ost" value="{{movie.score.ost}}">

                        </div>
                        
                        <div class="col-lg-5">
                            <div id="tab1" data-tab-content class="items active">
                                <div>
                                    <div class="point_area col-sm bg-light rounded-3 p-3 mb-3">
                                        <p>성별 · 나이별 만족도</p>
                                        <div>
                                            <span class="col">
                                                <i class="fas fa-mars male"></i>
                                                <b class="star">★</b>
                                                <a>{{movie.score.score_m}}</a>
                                            </span>
                                            <span class="col">
                                                <i class="fas fa-venus female"></i>
                                                <b class="star">★</b>
                                                <a>{{movie.score.score_w}}</a>
                                            </span>
                                        </div>
                                        <!-- 연령대별 만족도 자바스크립트 차트
                                        <div id="chartdiv"></div>
                                        -->
                                        <div class="tabs my-3">
                                            <div style="width: 33%"></div>
                                            <div style="width: 33%">
                                                <div class="point_box mb-2">
                                                    <span>10대</span>
                                                    <span>
                                                        <b class="star">★</b>
                                                        <a>{{movie.score.score_10}}</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span>20대</span>
                                                    <span>
                                                        <b class="star">★</b>
                                                        <a>{{movie.score.score_20}}</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span>30대</span>
                                                    <span>
                                                        <b class="star">★</b>
                                                        <a>{{movie.score.score_30}}</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span>40대</span>
                                                    <span>
                                                        <b class="star">★</b>
                                                        <a>{{movie.score.score_40}}</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-4">
                                                    <span>50대</span>
                                                    <span>
                                                        <b class="star">★</b>
                                                        <a>{{movie.score.score_50}}</a>
                                                    </span>
                                                </div>         
                                            </div>
                                            <div style="width: 33%"></div>
                                        </div>

                                    </div>
                                    <div class="point_area col-sm bg-light rounded-3 p-3">
                                        <p>감상포인트</p>
                                       
                                        <div id="chartdiv_2"></div> 
                                        
                                        <!-- 감상포인트 기본 버전 -->

                                        <!-- <div class="tabs">
                                            <div style="width: 33%"></div>
                                            <div style="width: 33%">
                                                <div class="point_box mb-2">
                                                    <span><b class="square_1">■</b> 연출</span>
                                                    <span>
                                                        <a>24%</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span><b class="square_2">■</b> 연기</span>
                                                    <span>
                                                        <a>24%</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span><b class="square_3">■</b> 스토리</span>
                                                    <span>
                                                        <a>21%</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span><b class="square_4">■</b> 영상미</span>
                                                    <span>
                                                        <a>20%</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span><b class="square_5">■</b> OST</span>
                                                    <span>
                                                        <a>11%</a>
                                                    </span>
                                                </div>
                                            </div>
                                            <div style="width: 33%"></div>
                                        </div> -->
                                        <div class="flexBox my-3">
                                            <div class="add_button"><a href="{% url 'movie:comment_create' movie.id  %}">감상평 등록</a></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- javascript tab 줄거리, 포인트 2분할 버전 -->

                    <!-- <div class="tabs_main">
                        <div class="tabs">
                            <div class="tab" data-tab-target="#tab1">
                            <p>평점</p>
                            </div>
                            <div class="tab" data-tab-target="#tab2">
                            <p>줄거리</p>
                            </div>
                        </div>
                        </div>
                        <div class="content">
                            <div id="tab1" data-tab-content class="items active">
                                <li>평점</li>
                                <div class="movie_content row">
                                    <div class="point_area col-sm">
                                        <p>성별 · 나이별 만족도</p>
                                        <div class="my-5">
                                            <span class="col">
                                                <i class="fas fa-mars male"></i>
                                                <b class="star">★</b>
                                                <a>8.27</a>
                                            </span>
                                            <span class="col">
                                                <i class="fas fa-venus female"></i>
                                                <b class="star">★</b>
                                                <a>9.51</a>
                                            </span>
                                        </div>
                                        {% comment %} javascript chart, 데이터 뽑아올 수 있으면 사용
                                        <div id="chartdiv"></div> {% endcomment %}
                                        
                                        <div class="tabs my-3">
                                            <div style="width: 33%"></div>
                                            <div style="width: 33%">
                                                <div class="point_box mb-2">
                                                    <span>10대</span>
                                                    <span>
                                                        <b class="star">★</b>
                                                        <a>9.19</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span>20대</span>
                                                    <span>
                                                        <b class="star">★</b>
                                                        <a>8.99</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span>30대</span>
                                                    <span>
                                                        <b class="star">★</b>
                                                        <a>8.56</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span>40대</span>
                                                    <span>
                                                        <b class="star">★</b>
                                                        <a>8.21</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-5">
                                                    <span>50대</span>
                                                    <span>
                                                        <b class="star">★</b>
                                                        <a>7.94</a>
                                                    </span>
                                                </div>         
                                            </div>
                                            <div style="width: 33%"></div>
                                        </div>

                                    </div>
                                    <div class="point_area col-sm">
                                        <p>감상포인트</p>
                                        {% comment %} javascript chart, 데이터 뽑아올 수 있으면 사용
                                        <div id="chartdiv_2"></div>  {% endcomment %}
                                        
                                        <div class="tabs my-5">
                                            <div style="width: 33%"></div>
                                            <div style="width: 33%">
                                                <div class="point_box mb-2">
                                                    <span><b class="square_1">■</b> 연출</span>
                                                    <span>
                                                        <a>24%</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span><b class="square_2">■</b> 연기</span>
                                                    <span>
                                                        <a>24%</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span><b class="square_3">■</b> 스토리</span>
                                                    <span>
                                                        <a>21%</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-2">
                                                    <span><b class="square_4">■</b> 영상미</span>
                                                    <span>
                                                        <a>20%</a>
                                                    </span>
                                                </div>
                                                <div class="point_box mb-5">
                                                    <span><b class="square_5">■</b> OST</span>
                                                    <span>
                                                        <a>11%</a>
                                                    </span>
                                                </div>
                                            </div>
                                            <div style="width: 33%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="tab2" data-tab-content class="items">
                                <li>줄거리</li>
                                <p>
                                어벤져스의 히어로 블랙 위도우, ‘나타샤 로마노프’ (스칼렛 요한슨)는
                                자신의 과거와 연결된 레드룸의 거대한 음모와 실체를 깨닫게 된다.
                                
                                상대의 능력을 복제하는 빌런 ‘태스크마스터’와 새로운 위도우들의 위협에 맞서
                                목숨을 건 반격을 시작하는 ‘나타샤’는 스파이로 활약했던 자신의 과거 뿐 아니라,
                                어벤져스가 되기 전 함께했던 동료들을 마주해야만 하는데…
                                
                                폭발하는 리얼 액션 카타르시스!
                                MCU의 새로운 시대를 시작할 첫 액션 블록버스터를 만끽하라!
                                </p>
                            </div>
                        </div>
                    </div> --> 
                </div>

                <table class="table">
                    <thead>
                        <tr class="text-center  bg-light rounded-3">
                            <th style="width: 5%;">평점</th>
                            <th style="width: 70%;">내용</th>
                            <th style="width: 5%;">작성자</th>
                            <th style="width: 20%;">작성일</th>
                        </tr>
                    </thead>
                    <tbody class="bg-light rounded-3">
                        <!-- 실제 데이터 입력받을 감상평 -->
                        
                    {% if movie.comment.count > 0 %}
                        {% for comment in movie.comment.all %}
                            <tr>
                                <td style="width: 5%; vertical-align: middle;" class="text-center td_content">{{comment.score_user}}</td>
                                <td style="width: 70%; vertical-align: middle;" class="text-start td_content">{{ comment.content }}</td>
                                <td style="width: 5%; vertical-align: middle;" class="text-center td_content">{{ comment.author }}</td>
                                <td style="width: 20%; vertical-align: middle;" class="text-center td_content">{{ comment.create_date }}
                                    {% if comment.modify_date %}<br>
                                    (수정: {{ comment.modify_date }})
                                    {% endif %}
                                    {% if request.user == comment.author %}
                                    <a href="{% url 'movie:comment_modify' comment.id  %}"><small class="text-danger"><br>수정</small></a>,
                                    <a href="{% url 'movie:comment_delete' comment.id  %}" data-uri="#"><small class="text-danger">삭제</small></a>
                                    {% endif %}
                                </td>
                            </tr>
                            <input type="hidden" id="score_user" value="{{comment.score_user}}"> 
                            <input type="hidden" id="point" value="{{comment.point}}"> 
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>

                <div class="mt-5">
                    <b class="">감상평 등록</b>
                    <hr></hr>
                    <form method="post" class="post-form my-3">
                        {% csrf_token %}
                        <!-- 오류표시 Start -->
                        {% if form.errors %}
                            <div class="alert alert-danger" role="alert">
                            {% for field in form %}
                                {% if field.errors %}
                                <strong>{{ field.label }}</strong>
                                {{ field.errors }}
                                {% endif %}
                            {% endfor %}
                            </div>
                        {% endif %}
                        <!-- 오류표시 End -->

                        <div class="d-flex justify-content-center row my-3  bg-light rounded-3">
                            <div class="point_form col-lg">
                                <div class="my-3"><i class="fas fa-check"></i> 평점을 선택하세요</div>
                                <div>
                                    <label><input type="radio" value=1.00 name="score_user"><span>1점</span></label>
                                    <label><input type="radio" value=2.00 name="score_user"><span>2점</span></label>
                                    <label><input type="radio" value=3.00 name="score_user"><span>3점</span></label>
                                    <label><input type="radio" value=4.00 name="score_user"><span>4점</span></label>
                                    <label><input type="radio" value=5.00 name="score_user"><span>5점</span></label>
                                    <label><input type="radio" value=6.00 name="score_user"><span>6점</span></label>
                                    <label><input type="radio" value=7.00 name="score_user"><span>7점</span></label>
                                    <label><input type="radio" value=8.00 name="score_user"><span>8점</span></label>
                                    <label><input type="radio" value=9.00 name="score_user"><span>9점</span></label>
                                    <label><input type="radio" value=10.00 name="score_user"><span>10점</span></label>
                                </div>
                            </div>

                            <div class="point_form col-lg">
                                <div class="my-3"><i class="fas fa-check"></i> 감상포인트를 추천해주세요</div>
                                <div>
                                    <label><input type="radio" value="production" name="point"><span>연출</span></label>
                                    <label><input type="radio" value="acting" name="point"><span>연기</span></label>
                                    <label><input type="radio" value="story" name="point"><span>스토리</span></label>
                                    <label><input type="radio" value="visual" name="point"><span>영상미</span></label>
                                    <label><input type="radio" value="ost" name="point"><span>OST</span></label>
                                </div>                            
                            </div>
                        </div>

                        <div class="flexBox row">
                            <textarea 
                                class="text_area" 
                                name="content"
                                id="content" 
                                rows="8"
                                placeholder="감상평을 남겨주세요. 최대 1,000자까지 입력 가능합니다."
                                required
                                autofocus
                            >{{ form.content.value|default_if_none:'' }}</textarea>
                            <button type="submit" class="add_button_2 my-3" style="color:white">저장</button>
                        </div>
                    </form>
                </div>
        </div>
    </div>


    

    <script>
        var score_user = document.getElementById("score_user").value; // 평점, 감상포인트 수정 시 checked 를 위해 변수 선언
        var point= document.getElementById("point").value;

        $(document).ready(function() { // textarea 글자 수 제한
        $('#content').on('keyup', function() {

        if($(this).val().length > 1000) {
        alert("최대 1,000자까지 입력 가능합니다.");
        $(this).val($(this).val().substring(0, 1000));
        }

        });
        });

        $(":radio[name='score_user'][value='"+score_user+"']").attr('checked', true); // 평점, 감상포인트 수정 시 checked 부여
        $(":radio[name='point'][value='"+point+"']").attr('checked', true);  
    </script>

    <!-- <script src={% static 'movie/js/radio_button.js' %}></script> radio button 중복 체크 script-->
    <script src={% static 'movie/js/movieinfo.js' %}></script>
    <!-- <script src={% static 'common/js/age_chart.js' %}></script> 연령대별 chart script-->
    <script src={% static 'movie/js/genre_chart.js' %}></script>


{% endblock %}